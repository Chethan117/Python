<ol><li>Calculate the Reference Date (Bkdt_dt): The script starts by determining a reference date (Bkdt_dt). If the current day is Monday, it subtracts 3 days from the current date; otherwise, it subtracts 1 day. This date will be used for comparison in the next steps.</li><li>Aggregate Daily Data: The first query aggregates transaction data on a daily basis, summing up transaction counts, authorization amounts, budgeted amounts, claim counts, and claim amounts for each day. The data is grouped by transaction type and fraud type.</li><li>Calculate Daily Averages for the Last 30 and 90 Days: The script calculates averages over the last 30 days using the avg_D_ST table. Similarly, it calculates averages over the last 90 days using the avg_D_lt table.</li><li>Compare Daily Data with Averages: The script then compares the daily transaction data with the 30-day and 90-day averages. It calculates the differences and percentage changes, comparing account transaction counts and authorization amounts.</li><li>Remove Old Daily Data: The script deletes any existing entries in the dly_revw_tab table where the metric name is "Daily."</li><li>Insert New Daily Data: It inserts the new daily metrics (including differences and percentages) into the dly_revw_tab table.</li><li>Aggregate Weekly Data: The script aggregates transaction data on a weekly basis, summing up transaction counts, authorization amounts, budgeted amounts, claim counts, and claim amounts for each week, starting from the reference date. The data is grouped by transaction type and fraud type.</li><li>Calculate Weekly Averages for the Last 30 and 90 Days: It calculates weekly averages over the last 30 days using the avg_w_ST table. Similarly, it calculates weekly averages over the last 90 days using the avg_w_lt table.</li><li>Compare Weekly Data with Averages: The script compares the weekly transaction data with the 30-day and 90-day averages, calculating differences and percentage changes, similar to the daily comparison.</li><li>Remove Old Weekly Data: It deletes any existing weekly metrics labeled "weekly" in the dly_revw_tab table.</li><li>Insert New Weekly Data: It inserts the new weekly metrics (including differences and percentages) into the dly_revw_tab table.</li><li>Aggregate Monthly Data: The script aggregates transaction data on a monthly basis, summing up transaction counts, authorization amounts, budgeted amounts, claim counts, and claim amounts for each month. The data is grouped by transaction type and fraud type.</li><li>Calculate Monthly Averages for the Last 30 and 90 Days: The script calculates monthly averages over the last 30 days using the avg_m_ST table. Similarly, it calculates monthly averages over the last 90 days using the avg_m_lt table.</li><li>Compare Monthly Data with Averages: The script compares the monthly transaction data with the 30-day and 90-day averages, calculating differences and percentage changes, just like it did for the daily and weekly comparisons.</li><li>Remove Old Monthly Data: The script deletes any existing monthly metrics labeled "monthly" in the dly_revw_tab table.</li><li>Insert New Monthly Data: It inserts the new monthly metrics (including differences and percentages) into the dly_revw_tab table.</li></ol>
